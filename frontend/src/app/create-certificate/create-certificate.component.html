<div id="container">
    <div id="content">
        <button mat-icon-button matTooltip="Back" class="back" (click)="back()">
            <mat-icon>keyboard_backspace</mat-icon>
          </button>
          <button mat-icon-button  matTooltip="Save template" id="save">
            <mat-icon>save</mat-icon>
          </button>
          <button mat-icon-button matTooltip="All templates" id="showAll">
            <mat-icon>favorite</mat-icon>
          </button>

        <mat-card id="main-card">
            <mat-card-header >
                <mat-card-title >
                  <label style="font-weight:bold; font-size: 25px;">Create certificate</label>
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>

                <mat-horizontal-stepper #stepper>
                  <mat-step [stepControl]="firstFormGroup" errorMessage="Please fill out all fields.">
                    <form [formGroup]="firstFormGroup">
                      <ng-template matStepLabel>Choose issuer, valid dates and algorithm</ng-template>
                      <div class="smaller_div">

                        <div class="input_div1">
                          <mat-form-field class="input1">
                            <mat-label>Issuer</mat-label>
                            <input matInput formControlName="issuer" required >
                          </mat-form-field>
  
                          <button mat-flat-button id="choose_issuer">Choose</button>
  
  
                          <!-- <br> -->
                          
                        </div>
                        <div class="input_div1">
                          <mat-form-field class="input1">
                            <mat-label>Valid from:</mat-label>
                            <input matInput [matDatepicker]="picker1" formControlName="validFrom">
                            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                            <mat-datepicker #picker1></mat-datepicker>
                          </mat-form-field>
                          
                          <mat-form-field class="input1">
                            <mat-label>Valid to:</mat-label>
                            <input matInput [matDatepicker]="picker2" formControlName="validTo">
                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                            <mat-datepicker #picker2 ></mat-datepicker>
                          </mat-form-field>
                        </div>
  
                        <div class="input_div1">
                          <mat-form-field class="input1">
                            <mat-label>Signature algorithm</mat-label>
                            <mat-select formControlName="signatureAlgorithm">
                              <mat-option value="SHA256withRSA">
                                SHA256withRSA
                              </mat-option>
                              <mat-option value="SHA512withRSA">
                                SHA512withRSA
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
  
                          <mat-form-field class="input1">
                            <mat-label>Public key algorithm</mat-label>
                            <input matInput formControlName="pubKeyAlgorithm" readonly>
                          </mat-form-field>
                        </div>
                        <div>
                          <button id="next" mat-button matStepperNext>Next</button>
                        </div>
                      </div>
                      
                    </form>
                  </mat-step>


                  <mat-step [stepControl]="secondFormGroup" errorMessage="Please choose or fill subject.">
                    <form [formGroup]="secondFormGroup">
                      <ng-template matStepLabel>Choose or fill in subject</ng-template>

                      <div class="input_div1">
                        <mat-form-field class="input1">
                          <mat-label>First name</mat-label>
                          <input matInput placeholder="First name" formControlName="firstName" required >
                        </mat-form-field>

                        <mat-form-field class="input1">
                          <mat-label>Last name</mat-label>
                          <input matInput placeholder="Last name" formControlName="lastName" required >
                        </mat-form-field>
                        
                      </div>
                      
                      <div class="input_div1">
                        <mat-form-field class="input1">
                          <mat-label>State</mat-label>
                          <input matInput placeholder="State" formControlName="state" required >
                        </mat-form-field>

                        <mat-form-field class="input1">
                          <mat-label>City</mat-label>
                          <input matInput placeholder="City" formControlName="city" required >
                        </mat-form-field>
                        
                      </div>

                      <div class="input_div1">
                        <mat-form-field class="input1">
                          <mat-label>Organization</mat-label>
                          <input matInput placeholder="Organization" formControlName="org" required >
                        </mat-form-field>

                        <mat-form-field class="input1">
                          <mat-label>Organizational unit</mat-label>
                          <input matInput placeholder="Organizational unit" formControlName="orgunit" required >
                        </mat-form-field>
                        
                      </div>

                      <div class="input_div1">
                        <mat-form-field class="input1">
                          <mat-label>Allias</mat-label>
                          <input matInput placeholder="Allias" formControlName="allias" required >
                        </mat-form-field>

                        <mat-form-field class="input1">
                          <mat-label>Email</mat-label>
                          <input matInput placeholder="Email" formControlName="email" required >
                        </mat-form-field>
                        
                      </div>
                      <div class="input_div1">
                        <p><b>Or</b></p>
                      </div>
                      <div class="input_div1">
                        <mat-form-field style="width: 80%;">
                          <mat-label>Subject</mat-label>
                          <mat-select formControlName="chosenSubject">
                            <mat-option *ngFor="let sub of allSubjects"  [value]="sub">{{sub}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div>
                        <button id="back" mat-button matStepperPrevious>Back</button>
                        <button id="next" mat-button matStepperNext>Next</button>
                      </div>
                    </form>
                  </mat-step>



                  <mat-step [stepControl]="thirdFormGroup" errorMessage="Please choose extensions">
                    <form [formGroup]="thirdFormGroup">
                      <ng-template matStepLabel>Choose extensions</ng-template>
                      <div id="extensions-div" >
                        <mat-accordion >
                          <mat-expansion-panel>
                            <mat-expansion-panel-header>
                              <mat-panel-title>
                                Key usage extension
                              </mat-panel-title>
                              <mat-panel-description>
                                Add Key usage extensions to your certificate
                              </mat-panel-description>
                            </mat-expansion-panel-header>
                        
                            <!-- <mat-card class="extension-card"> -->
                              <!-- <mat-card-content > -->
                                <mat-form-field  style="margin-left: 30% ;width: 40%;">
                                  <mat-label>Key usage extensions</mat-label>
                                  <mat-select [(value)]="selectedKeyUsages" formControlName="keyUsage" multiple>
                                    <mat-option *ngFor="let keyusageext of allKeyUsages"  [value]="keyusageext">{{keyusageext}}</mat-option>
                                  </mat-select>
                                </mat-form-field>
                                <p *ngIf="selectedKeyUsages!==undefined">
                                  <b>Chosen key usage extensions:</b> {{selectedKeyUsages}} 
                                </p>
                                
                                 <!-- <mat-form-field class="example-chip-list" style="width:100%">
                                  <mat-label>Key usage extensions</mat-label>
                                  <mat-chip-list #chipList aria-label="Key usage">
                                    <mat-chip
                                      *ngFor="let usage of chosenKeyUsages"
                                      [selectable]="selectable"
                                      [removable]="removable"
                                      (removed)="remove(usage)">
                                      {{usage}}
                                      <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                                    </mat-chip>
                                    <input
                                      placeholder="New key usage extension..."
                                      #keyUsageInput
                                      [formControl]="keyUsageControl"
                                      [matAutocomplete]="auto"
                                      [matChipInputFor]="chipList"
                                      (matChipInputTokenEnd)="add($event)" 
                                      >
                                  </mat-chip-list>
                                  <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                                    <mat-option *ngFor="let usage of filteredKeyUsages | async" [value]="usage">
                                      {{usage}}
                                    </mat-option>
                                  </mat-autocomplete>
                                </mat-form-field>
 -->
<!-- 

                              </mat-card-content>
                              
                            </mat-card> -->

                            
                          </mat-expansion-panel>
                        </mat-accordion>
                        <mat-accordion>
                          <mat-expansion-panel>
                            <mat-expansion-panel-header>
                              <mat-panel-title>
                                Extended key usage
                              </mat-panel-title>
                              <mat-panel-description>
                                Add extended key usages to your certificate
                              </mat-panel-description>
                            </mat-expansion-panel-header>
                        


                            <mat-form-field  style="margin-left: 30% ;width: 40%;">
                              <mat-label>Key usage extensions</mat-label>
                              <mat-select [(value)]="selectedExtendedKeyUsages" formControlName="extendedKeyUsage" multiple>
                                <mat-option *ngFor="let keyusageext of allExtendedKeyUsages"  [value]="keyusageext">{{keyusageext}}</mat-option>
                              </mat-select>
                            </mat-form-field>
                            <p *ngIf="selectedExtendedKeyUsages!==undefined">
                              <b>Chosen extended key usage extensions:</b> {{selectedExtendedKeyUsages}} 
                            </p>

                          </mat-expansion-panel>
                        </mat-accordion>
                      </div>


                      <div>
                        <button id="back" mat-button matStepperPrevious>Back</button>
                        <button id="next" mat-button matStepperNext>Next</button>
                      </div>
                    </form>
                  </mat-step>
                  <mat-step>
                    <ng-template matStepLabel>Done</ng-template>
                    <p *ngIf="firstFormGroup.valid && secondFormGroup.valid && thirdFormGroup.valid">Your certificate is created!</p>
                    <p *ngIf="!firstFormGroup.valid || !secondFormGroup.valid || !thirdFormGroup.valid">Please fill form acording to instructions!</p>

                    <!-- <button id="back" mat-button >Download</button> -->

                    <div>
                      <button id="back" mat-button matStepperPrevious>Back</button>

                      <button id="next" style="margin-right: 10%;" mat-button (click)="stepper.reset()">Reset</button>

                    </div>
                  </mat-step>
                </mat-horizontal-stepper>
              </mat-card-content>
        </mat-card>

    </div>
</div>